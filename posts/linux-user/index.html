<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><title>Linux 用户和组 | World of Forks</title><meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1,initial-scale=1"><link rel="canonical" href="https://gbyukg.github.io/posts/linux-user/"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"><link rel="stylesheet" href="https://gbyukg.github.io/css/index-37cec208b5.css"><link href="https://gbyukg.github.io/index.xml" rel="alternate" type="application/rss+xml" title="World of Forks"><link href="https://gbyukg.github.io/index.xml" rel="feed" type="application/rss+xml" title="World of Forks"><link href="https://gbyukg.github.io/favicon.ico" rel="shortcut icon"><script>window.baseURL = 'https:\/\/gbyukg.github.io';</script></head><body><div class="navbar-fixed"><nav class="navbar"><div class="nav-container container"><div class="nav-wrapper inner"><a href="javascript:void(0)" data-activates="sidebar" class="button-collapse hide-on-large-only"><i class="material-icons">menu</i> </a><a href="https://gbyukg.github.io" class="brand-logo"><i class="material-icons hide-on-med-and-down">restaurant_menu</i> World of Forks</a><ul class="nav-menu tabs tabs-transparent hide-on-med-and-down"><li class="tab"><a href="https://gbyukg.github.io/" class="">Home</a></li><li class="tab"><a href="https://gbyukg.github.io/archive/" class="">Archive</a></li><li class="tab"><a href="https://gbyukg.github.io/about/" class="">About</a></li></ul><form class="nav-form hide-on-small-and-down"><div class="form-group"><i class="material-icons">search</i> <input type="text" placeholder="输入搜索关键字"></div><div class="form-popout"><div class="search-result"><label>暂无搜索结果</label><ul></ul></div></div></form><ul class="nav-menu apps"><li><a class="search-btn hide-on-med-and-up" href="#search-panel"><i class="material-icons">search</i></a></li><li><a class="term-btn hide-on-small-and-down" href="#term-panel"><i class="material-icons">apps</i></a></li><li><a class="rss-btn hide-on-small-and-down" href="https://gbyukg.github.io/index.xml" target="_blank"><i class="material-icons">rss_feed</i></a></li></ul></div></div></nav></div><div class="mobile-search hide-on-med-and-up"><div class="header"><i class="material-icons">search</i> <input type="text" placeholder="输入搜索关键字"> <i class="material-icons mobile-search-close">cancel</i></div><div class="content"><label>暂无搜索结果</label><ul></ul></div></div><div class="taxonomy"><div class="container"><div class="inner"><div class="taxonomy-panel"><div class="group"><label>Category</label><ul><li><a class="btn btn-secondary" href="https://gbyukg.github.io/categories/devops">devops <span class="badge">3</span></a></li><li><a class="btn btn-secondary" href="https://gbyukg.github.io/categories/programming">programming <span class="badge">3</span></a></li><li><a class="btn btn-secondary" href="https://gbyukg.github.io/categories/system">system <span class="badge">3</span></a></li><li><a class="btn btn-secondary" href="https://gbyukg.github.io/categories/database">database <span class="badge">1</span></a></li></ul></div><div class="group"><label>Tag</label><ul><li><a class="btn btn-secondary" href="https://gbyukg.github.io/tags/centos">centos <span class="badge">3</span></a></li><li><a class="btn btn-secondary" href="https://gbyukg.github.io/tags/python">python <span class="badge">3</span></a></li><li><a class="btn btn-secondary" href="https://gbyukg.github.io/tags/aix">aix <span class="badge">2</span></a></li><li><a class="btn btn-secondary" href="https://gbyukg.github.io/tags/apache">apache <span class="badge">1</span></a></li><li><a class="btn btn-secondary" href="https://gbyukg.github.io/tags/db2">db2 <span class="badge">1</span></a></li><li><a class="btn btn-secondary" href="https://gbyukg.github.io/tags/design-patterns">design-patterns <span class="badge">1</span></a></li><li><a class="btn btn-secondary" href="https://gbyukg.github.io/tags/devops">devops <span class="badge">1</span></a></li><li><a class="btn btn-secondary" href="https://gbyukg.github.io/tags/jenkins">jenkins <span class="badge">1</span></a></li><li><a class="btn btn-secondary" href="https://gbyukg.github.io/tags/linux">linux <span class="badge">1</span></a></li><li><a class="btn btn-secondary" href="https://gbyukg.github.io/tags/php">php <span class="badge">1</span></a></li><li><a class="btn btn-secondary" href="https://gbyukg.github.io/tags/ubuntu">ubuntu <span class="badge">1</span></a></li><li><a class="btn btn-secondary" href="https://gbyukg.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93">数据库 <span class="badge">1</span></a></li></ul></div></div></div></div></div><ul class="side-nav" id="sidebar"><li><a href="https://gbyukg.github.io/" class="">Home</a></li><li><a href="https://gbyukg.github.io/archive/" class="">Archive</a></li><li><a href="https://gbyukg.github.io/about/" class="">About</a></li><li><a class="term-btn-mobile hide-on-med-only" href="https://gbyukg.github.io/categories/">Categories</a></li><li><a class="term-btn-mobile hide-on-med-only" href="https://gbyukg.github.io/tags/">Tags</a></li><li><a class="rss-btn-mobile hide-on-med-only" href="https://gbyukg.github.io/index.xml" target="_blank">Rss</a></li></ul><main id="single" role="main" class="main-panel"><div class="page-content"><div class="container container-ex"><div class="inner"><section class="post-wrapper"><div class="toc-panel"><nav id="TableOfContents"><ul><li><ul><li><a href="#用户管理">用户管理</a><ul><li><a href="#useradd-创建用户"><code>useradd</code> 创建用户</a><ul><li><a href="#示例">示例</a></li></ul></li><li><a href="#id-命令查看用户信息"><code>id</code> 命令查看用户信息</a><ul><li><a href="#示例-1">示例</a></li></ul></li><li><a href="#passwd-修改用户密码"><code>passwd</code> 修改用户密码</a><ul><li><a href="#示例-2">示例</a></li><li><a href="#在脚本中修改用户密码">在脚本中修改用户密码</a></li></ul></li><li><a href="#usermod-更新用户信息"><code>usermod</code> 更新用户信息</a><ul><li><a href="#示例-3">示例</a></li></ul></li><li><a href="#chage-修改用户日期设定"><code>chage</code> 修改用户日期设定</a><ul><li><a href="#示例-4">示例</a></li></ul></li><li><a href="#userdel-删除用户"><code>userdel</code> 删除用户</a><ul><li><a href="#示例-5">示例：</a></li></ul></li><li><a href="#用户相关的系统文件">用户相关的系统文件</a><ul><li><a href="#etc-default-useradd">/etc/default/useradd</a></li><li><a href="#etc-passwd">/etc/passwd</a></li><li><a href="#etc-shadow">/etc/shadow</a></li></ul></li></ul></li><li><a href="#组管理">组管理</a><ul><li><a href="#groupadd-创建组"><code>groupadd</code> 创建组</a><ul><li><a href="#示例-6">示例</a></li></ul></li><li><a href="#查看组信息">查看组信息</a></li><li><a href="#groupmod-修改组信息"><code>groupmod</code> 修改组信息</a><ul><li><a href="#示例-7">示例</a></li></ul></li><li><a href="#groupdel-删除组"><code>groupdel</code> 删除组</a></li><li><a href="#组相关的系统文件">组相关的系统文件</a><ul><li><a href="#etc-group">/etc/group</a></li></ul></li></ul></li></ul></li></ul></nav></div><div class="post reveal"><div class="card"><section class="breadcrumb-root"><div class="breadcrumbs" role="navigation" aria-label="breadcrumbs navigation"><a class="breadcrumb" href="https://gbyukg.github.io"><i class="material-icons">location_on</i>Home</a> <span class="breadcrumb">Linux 用户和组</span></div></section><div class="card-header postinfo"><span class="card-title">Linux 用户和组</span></div><div class="card-header date"><div class="group"><i class="material-icons">book</i><address>归档： <a href="https://gbyukg.github.io/categories/system">System</a>&nbsp;</address></div><div class="group"><i class="material-icons">flag</i> <time>创建：2016年03月23日</time></div><div class="group"><i class="material-icons">mode_edit</i> <time>修改：2018年02月28日</time></div></div><div class="card-content"><article class="article"><p>用户其实就是系统中的账号，只有拥有了账号，我们才可以登录到系统中，执行相应的操作。每个用户又必须属于一个 <strong>主组</strong> 和一个或多个 <strong>其他组</strong>。用户和组又是构成 Linux 权限管理的基础，因此了解用户和组，对学习 Linux 至关重要。<br><br></p><p>本文意在向大家简单介绍如何在 Linux 下通过命令行的方式对用户和组进行操作。通过该文的讲解，你将能够掌握到以下命令：</p><ul><li><code>useradd</code> 创建新用户<br></li><li><code>passwd</code> 和 <code>chpasswd</code> 修改用户密码<br></li><li><code>usermod</code> 修改用户属性<br></li><li><code>chage</code> 修改用户已日期相关信息<br></li><li><code>userdel</code> 删除用户<br></li><li><code>groupadd</code> 创建组<br></li><li><code>groupdel</code>删除组<br></li><li><code>id</code> 查看用户信息<br></li><li><code>ulimit</code> 用户资源限制相关操作<br><br></li></ul><p>本文所使用的系统环境为 <code>CentOS 7.4</code>，并且所有命令都运行在 root 用户下，如果您没有登录 root 用户的权限，则至少有 <code>sudo</code> 权限，并在所有命令前使用 <code>sudo</code> 命令。</p><h2 id="用户管理">用户管理</h2><p>在这一节中，我们将学习如果创建新用户，查看用户信息，修改用该信息及密码，以及与用户相关的以为文件。</p><h3 id="useradd-创建用户"><code>useradd</code> 创建用户</h3><p>在 Linux 下，我们可以通过命令 <code>useradd</code><sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup> 来创建一个新用户，其格式为 <code>useradd [options] LOGIN</code>。 它可以接受一个或者多个参数，下面列出了一些常用的参数：<br><br></p><p></p><ul><li><code>-d，--home HOME_DIR</code>：该选项接收一个路径作为参数，用于指定新创建的用户的 home 目录。如果没有指定该选项，则默认在 <code>/home</code> 目录下创建一个与用户名同名的文件夹作为新创建用户的 home 目录。<br></li><li><code>-m, --create-home</code>：如果系统默认设定为不为新用户创建 home 目录时，可以使用该选项明确指定为用户创建 home 目录。另外，如果命令行中同时使用了 -k 选项，该选项也必须被明确指定，才会使 <code>-k</code> 选项生效。<br></li><li><code>-M</code>：不为新创建的这个用户创建任何 home 目录（默认为新用户创建 home 目录）。<br></li><li><code>-u, --uid UID</code>：每个用户在系统中都存在一个唯一的标识号： UID。 当创建一个新用户时，系统会自动分配一个当前可用的最小 ID 作为这个用户的 UID，在 CentOS 下，普通用户级别的起始 ID 为 1000。通过该选项，我们可以为新创建的用户手动指定一个 UID 。但该 UID 必须没有被使用。<br></li><li><code>-U，--user-group</code>：创建一个与新用户同名的组，并将该用户添加到这个组中（默认行为）。<br></li><li><code>-g, --gid GROUP</code>：将组 GROUP 指定为该用户的主组（主组的概念将会在用户组这一节中介绍），GROUP 可以是组名，也可以是组 ID，但前提是该组必须是已经存在的组。<br></li><li><code>-G, --groups GROUP1[,GROUP2,...[,GROUPN]]</code>：将新创建的用户同时加入到指定的这些组中，各个组之间使用逗号分隔，中间不能含有任何多余的空格。同样，这些组必须都是已经存在的组。<br></li><li><code>-N, --no-user-group</code>：不会创建与用户名同名的组，如果没有指定 <code>-g</code> 选项，则将该用户添加到系统默认组中。<br></li><li><code>-s，--shell SHELL</code>：用于指定用户的登录 SHELL。默认为 bash<br></li><li><code>-c, --comment COMMENT</code>：为新创建的用户添加一些说明。<br></li><li><code>-e, --expiredate EXPIRE_DATE</code>：指定新用户的过期日志，EXPIRE_DATE 格式为： <code>YYYY-MM-dd</code><br></li><li><code>-k, --skel SKEL_DIR</code>：默认情况下，当新用户被创建后，useradd 命令会将 <code>/etc/skel</code> 文件夹下的文件拷贝到新用户的 home 目录中。该参数可以让我们手动指定拷贝 <code>SKEL_DIR</code> 目录下的文件到新用户的跟目录下。需要注意的是，如果指定了该选项，则必须同时指定 <code>-m</code> 选项，否则不会生效。<br><br></li></ul><h4 id="示例">示例</h4><p><strong>创建一个名为 luke1 的新用户：</strong></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span>$ useradd luke1</code></pre></div><p>默认情况下，等同于：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span>$ useradd -m -U luke1</code></pre></div><p>该命令将会执行以下几个步骤：</p><ul><li>创建一个名为 luke1。<br></li><li>创建一个与用户名同名的新组。<br></li><li>将该用户的主组和其他组全部设定为这个新组。<br></li><li>在 <code>/home</code> 目录下创建一个 <code>luke1</code> 文件夹作为 luke1 用户的 home 目录。<br><br></li></ul><p>我们可以使用命令 <code>id</code> 来查看用户详细信息：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span>$ id luke1
uid<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span></code></pre></div><p>通过该命令，可以观察到，我们先创建的用户 UID 为 1000，新创建的组 ID 也为 1000.<br><br></p><p><strong>指定其他路径作为新创建用户的根目录为：</strong></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span>$ useradd -d /var/www/ luke2</code></pre></div><p>该命令会在 <code>/var</code> 目录下创建一个 <code>www</code> 文件夹，并将目录 <code>/var/www</code> 指定为 luke2 用户的根目录。<br><br></p><p><strong>不创建 home 目录</strong></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span>$ useradd -M luke3</code></pre></div><p>不会为 luke3 用户创建根目录，但注意，这并不代表 luke3 用户没有跟目录，只是根目录没有被创建罢了。<br><br></p><p><strong>指定新创建用户的 UID</strong></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span>$ useradd -u <span style="color:#ae81ff">1005</span> luke4
<span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ id luke4
uid<span style="color:#f92672">=</span><span style="color:#ae81ff">1005</span><span style="color:#f92672">(</span>luke4<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span><span style="color:#ae81ff">1005</span><span style="color:#f92672">(</span>luke4<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span><span style="color:#ae81ff">1005</span><span style="color:#f92672">(</span>luke4<span style="color:#f92672">)</span></code></pre></div><p>新创建用户的 UID 为 1005</p><blockquote><p>注意：当我们在创建一个新用户时如果为该用户指定了 UID，在这之后创建的用户的 UID 会在该 UID 基础之上进行增加，继续看下面的例子。<br><br></p></blockquote><p><strong>指定用户的主组</strong></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ useradd -N -g <span style="color:#ae81ff">0</span> luke5
<span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ id luke5
uid<span style="color:#f92672">=</span><span style="color:#ae81ff">1006</span><span style="color:#f92672">(</span>luke5<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">(</span>root<span style="color:#f92672">)</span></code></pre></div><p><code>-N</code> 选项指明了不会创建 luke5 组，而是将新用户添加到 0（root） 组下。事实上，当指定了 <code>-g</code> 参数时，<code>-N</code> 可以忽略。<br>同时，我们注意到，luke5 用户的 UID 为 1006，实在 luke4 的 UID 基础上加 1 得到的。</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ useradd -N luke5-b
<span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ id luke5-b
uid<span style="color:#f92672">=</span><span style="color:#ae81ff">1007</span><span style="color:#f92672">(</span>luke5-b<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span><span style="color:#f92672">(</span>users<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span><span style="color:#f92672">(</span>users<span style="color:#f92672">)</span></code></pre></div><p>可以看到，新创建的用户 luke5-b 被添加到系统默认用户组 users 中。<br><br></p><p><strong>将新用户添加到多个组中</strong></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ useradd -u <span style="color:#ae81ff">1010</span> -g luke1 -G luke2,luke3,luke4 -d /var/luke6/ -m luke6
<span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ id luke6
uid<span style="color:#f92672">=</span><span style="color:#ae81ff">1010</span><span style="color:#f92672">(</span>luke6<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span><span style="color:#ae81ff">1002</span><span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span><span style="color:#ae81ff">1002</span><span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span>,1003<span style="color:#f92672">(</span>luke2<span style="color:#f92672">)</span>,1004<span style="color:#f92672">(</span>luke3<span style="color:#f92672">)</span>,1005<span style="color:#f92672">(</span>luke4<span style="color:#f92672">)</span></code></pre></div><p>指定 luke6 主组 luke1，该用户同时属于 luke2，luke3 和 luke4 组。并创建 <code>/var/luke6/</code> 作为其 home 目录。<br><br></p><p><strong>修改 login shell</strong></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ useradd -s /bin/bash -c <span style="color:#e6db74">&#34;Testing user&#34;</span> luke7</code></pre></div><p>指定 luke7 用户默认的登录 SHELL 为 bash，并为该用户添加了简短的注释。<br><br></p><p><strong>指定用户过期日期</strong></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ useradd -e <span style="color:#ae81ff">2018</span>-02-24 luke8
<span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ chage -l luke8
Last password change					: Feb <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">2018</span>
Password expires					: never
Password inactive					: never
Account expires						: Feb <span style="color:#ae81ff">24</span>, <span style="color:#ae81ff">2018</span>
Minimum number of days between password change		: <span style="color:#ae81ff">0</span>
Maximum number of days between password change		: <span style="color:#ae81ff">99999</span>
Number of days of warning before password expires	: <span style="color:#ae81ff">7</span></code></pre></div><p>通过 <code>-e</code> 选项将账号过期日志指定为 Feb 24, 2018，可以通过 <code>chage -l username</code> 方式查看账户过期日期。关于 <code>chage</code> 命令的详细说明，将会在下面小节中介绍。<br>另一个例子：将新创建账号的过期日期设置为 300 天之后</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">useradd -e <span style="color:#e6db74">`</span>date -d <span style="color:#e6db74">&#34;300 days&#34;</span> +<span style="color:#e6db74">&#34;%Y-%m-%d&#34;</span><span style="color:#e6db74">`</span> luke8</code></pre></div><h3 id="id-命令查看用户信息"><code>id</code> 命令查看用户信息</h3><p>当我们想要查看某个用户信息时，可以使用命令行工具 <code>id</code>，该命令可以让我们获取到用户的用户名，UID，主组名及其主组 ID，所有其他组名称和组 ID 等信息，其基本格式为：<code>id [OPTION] [USERNAME]</code>。<br><br></p><p>其中 OPTION 和 USERNAME 均为可选参数，如果没有指定任何 username 参数，则获取当前用户信息。<br><br></p><p>下面列出了一些常用的选项：</p><ul><li><code>-u，--user</code>：只显示用户的 UID<br></li><li><code>-g，--group</code>：打印出用户主组 ID。<br></li><li><code>-G，--groups</code>：打印出用户所有其他组 ID。<br></li><li><code>-n，--name</code>：显示用户或组的名称，而非他们的 ID。<br><br></li></ul><h4 id="示例-1">示例</h4><p><strong>获取当前用户的信息：</strong></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># id
</span><span style="color:#75715e"></span>uid<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> context<span style="color:#f92672">=</span>unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</code></pre></div><p><br></p><p><strong>获取指定用户的信息</strong></p><p>通过在命令行后指定 luke1，来获取指定用户的信息：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># id luke1
</span><span style="color:#75715e"></span>uid<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span><span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span><span style="color:#ae81ff">1002</span><span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span><span style="color:#ae81ff">1002</span><span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span></code></pre></div><p><br></p><p><strong>获取用户 UID</strong></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>luke1@promote ~<span style="color:#f92672">]</span>$ id -u luke1
<span style="color:#ae81ff">1001</span></code></pre></div><p><br></p><p><strong>获取用户的用户名</strong></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>luke1@promote ~<span style="color:#f92672">]</span>$ id -un luke1
luke1</code></pre></div><p><br></p><p><strong>获取用户的主组 ID</strong><br>通过 <code>-g</code> 或 <code>--group</code> 命令获取到用户的主组 ID：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>luke1@promote ~<span style="color:#f92672">]</span>$ id -g luke1
<span style="color:#ae81ff">1001</span></code></pre></div><p>该命令等同于：<code>id --group luke1</code><br><br></p><p><strong>获取用户的主组名称</strong><br>通过 <code>-n</code> 或 <code>--name</code> 获取相应的名字，而非 ID 值：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>luke1@promote ~<span style="color:#f92672">]</span>$ id -gn luke1
luke1</code></pre></div><p><br></p><p><strong>获取用户的其他组 ID 和名称</strong></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>luke1@promote ~<span style="color:#f92672">]</span>$ id -G luke1
<span style="color:#ae81ff">1002</span>
<span style="color:#f92672">[</span>luke1@promote ~<span style="color:#f92672">]</span>$ id -Gn luke1
luke1</code></pre></div><p><br></p><h3 id="passwd-修改用户密码"><code>passwd</code> 修改用户密码</h3><p>当成功创建好一个用户后，一般都需要为新创建的用户设置密码。可以使用命令行工具 <code>passwd</code> 为某个用户设置密码，其格式为：<code>passwd [OPTION] [USERNAME]</code><br><br></p><p>其中 OPTION 和 USERNAME 均为可选参数，如果没有指定任何 username 参数，则为当前用户设置密码。<code>passwd</code> 不仅可以帮助我们为用户设置密码，它还可以用来查看和修改密码日期相关信息，比如设置密码过期日期等。<br><br></p><p>下面列出了一些常用的选项：</p><ul><li><code>-S，--status</code>：获取指定账号的状态信息。<br></li><li><code>-e，--expire</code>：使得某个用户的密码即可过期，这会强制用户在下次登录系统时修改密码。执行此命令的用户需要有特殊权限。<br></li><li><code>-n，--mindays MIN_DAYS</code>：设置两次密码修改的最小间隔天数为 MIN_DAYS。0 表示没有限制。<br></li><li><code>-x，--maxdays MAX_DAYS</code>：设置密码的有效天数为 MAX_DAYS，当超过 MAX_DAYS 天时，密码将过期。-1 表示密码永不过期。<br></li><li><code>-w，--warndays WARN_DAYS</code>：设置密码过期前 WARN_DAYS 天，用户开始收到报警信息。<br></li><li><code>-i，--inactive INACTIVE</code>：设置当密码过期 INACTIVE 天数后，账号将被锁定。被锁定的账号将无法登录到系统中。-1 表示永不锁定账号。<br></li><li><code>-l，--lock</code>：锁定指定账号的密码。<br></li><li><code>-u，--unlock</code>：解锁某个使用 <code>-l</code> 选项锁定的账号。<br></li><li><code>-d，--delete</code>：删除指定用户的密码。被删除密码的用户将无法登陆系统。<br><br></li></ul><h4 id="示例-2">示例</h4><p><strong>修改当前用户密码</strong><br>如果直接执行 <code>passwd</code> 命令而不加任何参数，系统将提示用户修改当前用户的密码。对于 root 用户来说，修改 root 密码不需要提供当前密码，而对于普通用户来说，需要提供当前密码才能当前用户密码。</p><p>root 用户直接输入新密码即可：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># passwd
</span><span style="color:#75715e"></span>Changing password <span style="color:#66d9ef">for</span> user root.
New password:</code></pre></div><p>对于普通用户，需要先提供用户的当前密码：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>luke1@promote ~<span style="color:#f92672">]</span>$ passwd
Changing password <span style="color:#66d9ef">for</span> user luke1.
Changing password <span style="color:#66d9ef">for</span> luke1.
<span style="color:#f92672">(</span>current<span style="color:#f92672">)</span> UNIX password:</code></pre></div><p><br></p><p><strong>特权用户修改其他用户密码</strong><br>拥有特权的用户除了可以修改自己密码之外，还可以修改其他用户密码，只需在 <code>passwd</code> 命令后指定要修改的用户名即可：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># passwd luke1
</span><span style="color:#75715e"></span>Changing password <span style="color:#66d9ef">for</span> user luke1.
New password:</code></pre></div><p>通过这种方式为其他用户修改密码，同样不需要提供用户的当前密码。<br><br></p><p><strong>获取用户账户信息</strong><br>使用 <code>-S</code> 可以获取指定用户的账号信息，返回的信息共包含 7 个字段，他们分别为：</p><ul><li>用户的登录名。<br></li><li>密码状态信息，包括以下几种状态：<br><ul><li><code>LK</code>： 表示账号密码被锁定；<br></li><li><code>NP</code>： 表示没有为该账号设置密码；<br></li><li><code>PS</code>： 表示密码被正确设置了；<br></li></ul></li><li>上次修改密码的时间。<br></li><li>两次密码修改的最小间隔天数。<br></li><li>密码多少天之后过期。<br></li><li>密码过期前多少天开始报警。<br></li><li>密码过期几天后帐号会被锁定。<br></li><li>密码状态的描述说明。<br><br></li></ul><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># passwd -S luke1
</span><span style="color:#75715e"></span>luke2 PS <span style="color:#ae81ff">2018</span>-02-26 <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">99999</span> <span style="color:#ae81ff">7</span> -1 <span style="color:#f92672">(</span>Password set, MD5 crypt.<span style="color:#f92672">)</span></code></pre></div><p>通过上面的输出，我们可以得出以下结论：luke1 账号密码被正确地使用 MD5 设置设置过了；设置密码的日期为 2018-02-26；账号 luke1 对两次密码修改时间的间隔没有任何限制，并且设置了密码用不过期；账号密码会在过期 7 天开始报警（这里该账号密码用不过期，因此该值没有意义）；即使密码过期后也不会锁定该账号。<br><br></p><p><strong>强制用户密码过期</strong><br>使用 <code>-e</code> 选项强制账户 luke1 的密码过期，当下次使用该账户登录系统时，将提示用户修改密码。</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span># passwd -e luke1</code></pre></div><p><br></p><p><strong>删除账号密码</strong><br>使用 <code>-d</code> 删除账号 luke1 的密码，删除密码后 luke1 用户将无法登录到系统中：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># passwd -d luke1
</span><span style="color:#75715e"></span>Removing password <span style="color:#66d9ef">for</span> user luke1.
passwd: Success
<span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># passwd -S luke1
</span><span style="color:#75715e"></span>luke1 NP <span style="color:#ae81ff">2018</span>-02-26 <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">99999</span> <span style="color:#ae81ff">45</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">(</span>Empty password.<span style="color:#f92672">)</span></code></pre></div><p><br></p><p><strong>锁定账号密码</strong><br>通过 <code>-l</code> 选项锁定账号 luke1 的密码。锁定账号密码并不影响账号的登录，仅仅是使账号的密码不可用。用户仍然可以使用其他方式，比如 SSH 秘钥的方式登录到系统中。</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># passwd -l luke1
</span><span style="color:#75715e"></span>Locking password <span style="color:#66d9ef">for</span> user luke1.
passwd: Success
<span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># passwd -S luke1
</span><span style="color:#75715e"></span>luke1 LK <span style="color:#ae81ff">2018</span>-02-26 <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">99999</span> <span style="color:#ae81ff">45</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">(</span>Password locked.<span style="color:#f92672">)</span></code></pre></div><p><br></p><p><strong>解锁账号密码</strong><br>使用 <code>-u</code> 选项可以解锁一个通过 <code>-l</code> 选项锁定的账户的密码：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># passwd -u luke1
</span><span style="color:#75715e"></span>Unlocking password <span style="color:#66d9ef">for</span> user luke1.
passwd: Success
<span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># passwd -S luke1
</span><span style="color:#75715e"></span>luke1 PS <span style="color:#ae81ff">2018</span>-02-26 <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">99999</span> <span style="color:#ae81ff">45</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">(</span>Password set, MD5 crypt.<span style="color:#f92672">)</span></code></pre></div><p><br></p><p><strong>设置两次密码修改的最短间隔</strong><br>设置账户 luke1 两次密码修改最短间隔为 2 天：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># passwd -n 2 luke1
</span><span style="color:#75715e"></span>Adjusting aging data <span style="color:#66d9ef">for</span> user luke1.
passwd: Success
<span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># passwd -S luke1
</span><span style="color:#75715e"></span>luke1 PS <span style="color:#ae81ff">2018</span>-02-26 <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">99999</span> <span style="color:#ae81ff">45</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">(</span>Password set, MD5 crypt.<span style="color:#f92672">)</span></code></pre></div><p><br></p><p><strong>设置密码过期时间</strong><br>设置账户 luke1 密码的过期时间在 90 天以后：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># passwd -x 90 luke1
</span><span style="color:#75715e"></span>Adjusting aging data <span style="color:#66d9ef">for</span> user luke1.
passwd: Success
<span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># passwd -S luke1
</span><span style="color:#75715e"></span>luke1 PS <span style="color:#ae81ff">2018</span>-02-26 <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">90</span> <span style="color:#ae81ff">45</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">(</span>Password set, MD5 crypt.<span style="color:#f92672">)</span></code></pre></div><p><br></p><p>对于没有特权的普通用户来说，直接在命令行输入 <code>pwasswd</code> 命令后，</p><p>对于有超级权限的用户来说，比如 root，不但可以修改自己账户的<br>当执行如果 <code>passwd</code> 命令后没有跟<br>如果直接在命令行中输入 <code>passwd</code> 命令，将会提示修改当前用户的</p><p><code>passwd</code> 命令不仅可以帮助我们为用户重置密码，它还可以修改用户密码的过期日期。</p><h4 id="在脚本中修改用户密码">在脚本中修改用户密码</h4><p><code>passwd</code> 采用的是交互式的方式来修改用户密码，但很多时候我们会使用脚本的方式创建账号并设置密码，交互式命令并不能满足我们的要求。这时可以使用 <code>--stdin</code> 参数指定标准输入，而不是提示用户输入密码，在通过管道的方式将密码传递个 <code>passwd</code> 命令：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># echo &#34;password&#34; | passwd --stdin luke1
</span><span style="color:#75715e"></span>Changing password <span style="color:#66d9ef">for</span> user luke1.
passwd: all authentication tokens updated successfully.</code></pre></div><p><br></p><p>对于某些没有为 <code>passwd</code> 命令提供 <code>--stdin</code> 参数的系统来说，还可以使用 <code>chpasswd</code> 命令来代替：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span># echo <span style="color:#e6db74">&#34;luke1:password&#34;</span> | chpasswd</code></pre></div><h3 id="usermod-更新用户信息"><code>usermod</code> 更新用户信息</h3><p><code>usermod</code> 命令可以帮助我们修改系统中已经存在的用户的属性信息，比如修改用户的登录名，home 目录，组信息，登录 SHELL 等。其格式为 <code>usermod [options] LOGIN</code>。<br><br></p><p>下面列出了一些常用的选项：</p><ul><li><code>-l, --login NEW_LOGIN</code>：更新用户的登录名为 NEW_LOGIN。注意，该选项并不会修改用户的 home 目录和 mail 文件。<br></li><li><code>-u, --uid UID</code>：<br></li><li><code>-d, --home HOME_DIR</code>：修改用户的 home 目录至 HOME_DIR，该选项只是简单将用户的 home 目录指向新的目录，而原 home 目录中的内容不会被迁移到新的 home 目录中，可以使用 <code>-m</code> 选项对原 home 目录中的内容进行迁移。<br></li><li><code>-m, --move-home</code>：将当前 home 目录中的内容迁移到新的 home 目录下。该选项必须与 <code>-d</code> 选项一起使用。<br></li><li><code>-L, --lock</code>：锁定用户的密码。该选项与 <code>passwd -l</code> 命令效果一样。<br></li><li><code>-U, --unlock</code>：解锁用户密码。该选项与 <code>passwd -u</code> 命令效果一样。<br></li><li><code>-g, --gid GROUP</code>：将用户的主组设置为 GROUP。GROUP 可以是组名，也可以是组 ID，但必须是系统中已经存在的组。修改用户的主组，用户 home 目录中所有文件的所属组也将同样被修改为该新组，而对于 home 目录之外的文件，需要用户手动进行修改。<br></li><li><code>-G, --groups GROUP1[,GROUP2,...[,GROUPN]]]</code>：将用户的其他组设置为指定的新组。同样，提供的参数可以是组名，也可以是组 ID。但这些组必须是系统中的有效组。<br></li><li><code>-a, --append</code>：与 <code>-G</code> 一起使用，将 <code>-G</code> 指定的组追加到当前用户的其他组中，而不是替换当前用户的其他组。<br></li><li><code>-e, --expiredate EXPIRE_DATE</code>：设置用户的账号过期日期为 EXPIRE_DATE，日期格式为：YYYY-MM-DD。可以通过指定 EXPIRE_DATE 的值为 -1 禁用账号过期功能。<br>&gt; 注意，<code>usermod -e</code> 命令用来设置用户的账号过期日期，而 <code>passwd -x</code> 用来设置用户的密码过期日期。账号过期的用户将无法登录到系统中，而密码过期的用户仍然可以登录到系统中，并且登录系统是会强制用户修改密码。<br></li><li><code>-f, --inactive INACTIVE</code>：设置账号密码过期 INACTIVE 天后账号将被锁定。0 表示密码过期时账号立即被锁定；-1 表示不锁定账号。<br></li><li><code>-s, --shell SHELL</code>：将用户的登录 SHELL 修改为新值 SHELL。<br></li><li><code>-c, --comment COMMENT</code>：修改用户说明信息。<br><br></li></ul><h4 id="示例-3">示例</h4><p><strong>修改用户账号的说明信息</strong><br>选项 <code>-c</code> 用来修改指定账号的说明信息，比如为 luke1 用户增加说明信息：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@promote ~<span style="color:#f92672">]</span># usermod -c <span style="color:#e6db74">&#34;This is Luke1&#34;</span> luke1</code></pre></div><p>当设置成功后，可以通过查看 <code>/etc/passwd</code> 文件获取该信息，关于该文件的说明，会在下面的小节中介绍到。</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@promote ~<span style="color:#f92672">]</span><span style="color:#75715e"># getent passwd luke1
</span><span style="color:#75715e"></span>luke1:x:1001:1002:This is Luke1:/home/luke1:/bin/bash</code></pre></div><p><br></p><p><strong>更新用户 home 目录</strong><br>使用 <code>-d</code> 选项将用户的 home 路径指向 <code>/var/www</code> 路径。并通过 <code>-m</code> 选项将原目录下的文件移动到新 home 路径下。</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@promote ~<span style="color:#f92672">]</span># usermod -m -d /var/www luke1</code></pre></div><p>如果没有指定 <code>-m</code> 选项，则仅仅是将 home 目录指向新目录，原目录中的文件并不会被迁移到新路径下。<br><br></p><p><strong>设置账号的过期日期</strong><br>选项 <code>-e</code> 用来更新账户的过期日期，日期格式为 <code>YYYY-MM-DD</code>。账号日期相关信息可以通过 <code>chage</code> 命令查看，我们将会在下节详细介绍 <code>chage</code> 命令。在更改账号过期日期前，先让我们查看一下当前用户 luke1 日期相关信息：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@promote ~<span style="color:#f92672">]</span><span style="color:#75715e"># chage -l luke1
</span><span style="color:#75715e"></span>Last password change					: Feb <span style="color:#ae81ff">27</span>, <span style="color:#ae81ff">2018</span>
Password expires					: never
Password inactive					: never
Account expires						: never
Minimum number of days between password change		: <span style="color:#ae81ff">2</span>
Maximum number of days between password change		: -1
Number of days of warning before password expires	: <span style="color:#ae81ff">45</span></code></pre></div><p><code>Account expires</code> 字段描述了账户过期时间，当前账户 luke1 没有设置任何过期时间。现在让我们将 luke1 用户的账号过期日期设置为 <code>2019-01-01</code>：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@promote ~<span style="color:#f92672">]</span><span style="color:#75715e"># usermod -e 2019-01-01 luke1
</span><span style="color:#75715e"></span><span style="color:#f92672">[</span>root@promote ~<span style="color:#f92672">]</span><span style="color:#75715e">#
</span><span style="color:#75715e"></span><span style="color:#f92672">[</span>root@promote ~<span style="color:#f92672">]</span><span style="color:#75715e"># chage -l luke1
</span><span style="color:#75715e"></span>Last password change					: Feb <span style="color:#ae81ff">27</span>, <span style="color:#ae81ff">2018</span>
Password expires					: never
Password inactive					: never
Account expires						: Jan <span style="color:#ae81ff">01</span>, <span style="color:#ae81ff">2019</span>
Minimum number of days between password change		: <span style="color:#ae81ff">2</span>
Maximum number of days between password change		: -1
Number of days of warning before password expires	: <span style="color:#ae81ff">45</span></code></pre></div><p><br></p><p><strong>修改用户主组</strong><br>选项 <code>-g</code> 用来修改用户的主组，在修改前首先用 <code>id</code> 命令查看 luke1 用户信息。</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@promote ~<span style="color:#f92672">]</span><span style="color:#75715e"># id luke1
</span><span style="color:#75715e"></span>uid<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span><span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span><span style="color:#ae81ff">1002</span><span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span><span style="color:#ae81ff">1002</span><span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span></code></pre></div><p>luke1 用户当前主组为 luke1，更新主组信息：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@promote ~<span style="color:#f92672">]</span><span style="color:#75715e"># usermod -g 0 luke1
</span><span style="color:#75715e"></span><span style="color:#f92672">[</span>root@promote ~<span style="color:#f92672">]</span><span style="color:#75715e"># id luke1
</span><span style="color:#75715e"></span>uid<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span><span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">(</span>root<span style="color:#f92672">)</span>,1002<span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span></code></pre></div><p>luke1 用户的主组被更新为 root 组。</p><blockquote><p>当修改用户主组后，用户 home 目录下的所有文件的所属组都将被更新为新的组。<br><br></p></blockquote><p><strong>向用户其他组中追加新组</strong><br>选项 <code>-G</code> 用来修改用户的其他组信息，如果没有指定 <code>-a</code> 参数，则将指定的组代替当前用户的其他组信息；如果同时指定了 <code>-a</code> 选项，则将指定的组追加到用户的其他组信息中。</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@promote ~<span style="color:#f92672">]</span><span style="color:#75715e"># usermod -aG luke2 luke1
</span><span style="color:#75715e"></span><span style="color:#f92672">[</span>root@promote ~<span style="color:#f92672">]</span><span style="color:#75715e"># id luke1
</span><span style="color:#75715e"></span>uid<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span><span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> <span style="color:#ae81ff">1002</span><span style="color:#f92672">(</span>luke1<span style="color:#f92672">)</span>,1003<span style="color:#f92672">(</span>luke2<span style="color:#f92672">)</span></code></pre></div><p><br></p><p><strong>锁定与解锁用户</strong><br>当我们想要禁用某个账户时，可以使用 <code>-L</code> 选项来锁定该账户：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@promote ~<span style="color:#f92672">]</span># usermod -L luke1</code></pre></div><blockquote><p>注意： 被锁定的账户将无法登录到系统中</p></blockquote><p>被锁定的的账户可以通过 <code>-U</code> 选项解锁：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@promote ~<span style="color:#f92672">]</span># usermod -U luke1</code></pre></div><p><br></p><p><strong>修改用户的登录 SHELL</strong><br>选项 <code>-s</code> 可以帮助我们修改用户的登录 SHELL：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">usermod -s /bin/zsh luke1</code></pre></div><h3 id="chage-修改用户日期设定"><code>chage</code> 修改用户日期设定</h3><p>在前面的小节中，我们介绍了如果使用 <code>passwd</code> 命令和 <code>usermod</code> 命令修改用户账号日期相关信息，比如密码过期日期、账号过期日期、密码修改最小间隔时间等。虽然这两个命令可以满足我们大部分的需求，但 Linux 还是提供了更专业的命令行工具 <code>chage</code>，来查看和修改与账户日期相关的信息。其基本格式为：<code>chage [options] LOGIN</code>。<br><br></p><p>下面列出了一些常用的选项：</p><ul><li><code>-l, --list</code>：打印出给定账户相关信息。<br></li><li><code>-M, --maxdays MAX_DAYS</code>：设置密码有效期天数为 MAX_DAYS 天。当超过指定的天数后，用户再次登录系统时将强制用户修改密码。值 MAX_DAYS 为 -1 表示密码永不过期。<br></li><li><code>-E, --expiredate EXPIRE_DATE</code>：设置用户的账号过期日期，其值 EXPIRE_DATE 可以使 <code>YYYY-MM-DD</code> 格式的日期，也可以是自 1970-01-01 以来到过期日期的天数。值 EXPIRE_DATE 为 -1 表示永不过期。<br></li><li><code>-I, --inactive INACTIVE</code>：设置账号密码过期 INACTIVE 天后，账号将被锁定。-1 表示关闭此功能。<br></li><li><code>-m, --mindays MIN_DAYS</code>：设置两次修改密码最少需要间隔 MIN_DAYS 天。<br></li><li><code>-W, --warndays WARN_DAYS</code>：设置密码过期前 WARN_DAYS 天系统开始提示警告信息。<br></li><li><code>-d, --lastday LAST_DAY</code>：手动修改上次密码的修改日期，其值 EXPIRE_DATE 可以使 <code>YYYY-MM-DD</code> 格式的日期，也可以是自 1970-01-01 以来上次修改密码的天数。如果指定 LAST_DAY 的值为 0，则用户在下次登录系统时将强制该用户修改密码。<br><br></li></ul><blockquote><p>注意：再次提醒，用户的账号过期与用户的密码过期不同。当账号过期后，用户将无法登录到系统中；当密码过期后，用户仍然可以登录到系统中，只是在登录系统时，系统会强制用户修改当前密码。</p></blockquote><h4 id="示例-4">示例</h4><p><strong>修改用户账号的过期日期</strong><br>在修改用户的账号过期日期之前，首先通过 <code>-l</code> 选项查看 luke1 账号在修改前的信息：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># chage -l luke1
</span><span style="color:#75715e"></span>Last password change					: Feb <span style="color:#ae81ff">27</span>, <span style="color:#ae81ff">2018</span>
Password expires					: never
Password inactive					: never
Account expires						: Jan <span style="color:#ae81ff">01</span>, <span style="color:#ae81ff">2019</span>
Minimum number of days between password change		: <span style="color:#ae81ff">2</span>
Maximum number of days between password change		: -1
Number of days of warning before password expires	: <span style="color:#ae81ff">45</span></code></pre></div><p>从输出中可以看出，用户的账号过期日期为 2019/1/1。现在，让我们使用 <code>-E</code> 选项为 luke1 用户重新设置账号过期日期：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># chage -E -1 luke1
</span><span style="color:#75715e"></span><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e">#
</span><span style="color:#75715e"></span><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># chage -l luke1
</span><span style="color:#75715e"></span>Last password change					: Feb <span style="color:#ae81ff">27</span>, <span style="color:#ae81ff">2018</span>
Password expires					: never
Password inactive					: never
Account expires						: never
Minimum number of days between password change		: <span style="color:#ae81ff">2</span>
Maximum number of days between password change		: -1
Number of days of warning before password expires	: <span style="color:#ae81ff">45</span></code></pre></div><p>luke1 账号的过期日期被成功设置为了永不过期。<br><br></p><p><strong>设置用户的密码过期时间</strong><br>从上面例子中获取到的信息中，我们可以看到，当前用户 luke1 的密码被设置为了永不过期。<br>这里，我们将通过 <code>-M</code> 参数设置该用户密码每次最多保留 90 天，当 90 天过后，用户密码将过期。</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># chage -M 90 luke1
</span><span style="color:#75715e"></span><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e">#
</span><span style="color:#75715e"></span><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># chage -l luke1
</span><span style="color:#75715e"></span>Last password change					: Feb <span style="color:#ae81ff">27</span>, <span style="color:#ae81ff">2018</span>
Password expires					: May <span style="color:#ae81ff">28</span>, <span style="color:#ae81ff">2018</span>
Password inactive					: Jun <span style="color:#ae81ff">02</span>, <span style="color:#ae81ff">2018</span>
Account expires						: never
Minimum number of days between password change		: <span style="color:#ae81ff">2</span>
Maximum number of days between password change		: <span style="color:#ae81ff">90</span>
Number of days of warning before password expires	: <span style="color:#ae81ff">45</span></code></pre></div><p><br></p><p><strong>同时修改多项</strong><br>下面，我们将尝试同时修改多项：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span># chage -I -1 -m <span style="color:#ae81ff">0</span> -M <span style="color:#ae81ff">99999</span> -E -1 luke1</code></pre></div><p>在这个例子中，我们设置了账号用不过期；两次密码修改间距天数不受限制；用户密码用不过期；即使密码过期，账户也永不过期。<br><br></p><h3 id="userdel-删除用户"><code>userdel</code> 删除用户</h3><p>当某个用户不在使用时，我们应当将该用户从系统中移除掉。可以使用 <code>userdel</code> 名来来删除某个用户。基本格式为：<code>userdel [options] LOGIN</code>。<br><br></p><p>下面列出了一些常用的选项：</p><ul><li><code>-f, --force</code>：强制删除用户，即使被删除的用户当前处于登录状态；同时该选项也会强制删除用户的 home 目录和 mail 文件，即使还有其他用户使用同样的目录作为 home 目录。<br></li><li><code>-r, --remove</code>：移除账户时，同时删掉该账户的 home 目录，及其所有 mail 文件。默认保留这些文件。<br><br></li></ul><h4 id="示例-5">示例：</h4><p><strong>删除用户</strong></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ userdel luke8
<span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ id luke8
id: luke8: no such user</code></pre></div><p>用户 luke8 已经不在存在了。<br><br></p><p><strong>删除用户的同时，删除其对用的 home 目录和 mail</strong><br>在上面的例子中，我们仅仅是删除了 luke8 用户，但其 home 目录 <code>/home/luke8/</code> 及其 mail 文件并没有被移除</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ ls -l /home/luke8/
total <span style="color:#ae81ff">0</span></code></pre></div><p>通过 <code>ls</code> 命令，我们仍然可以访问到 luke8 用户的 home 目录。<br>如果想要在删除用户时，同时将他的 home 目录一起删掉，可以在 <code>userdel</code> 命令中指定 <code>-r</code> 选项</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ useradd luke8
useradd: warning: the home directory already exists.
Not copying any file from skel directory into it.
Creating mailbox file: File exists
<span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ userdel -r luke8
<span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>$ ls -l /home/luke8
ls: cannot access /home/luke8: No such file or directory</code></pre></div><p>我们首先重新创建 luke8 user，系统会返回一些警告信息，提示 luke8 用户要使用的 home 目录已经存在了，这里可以直接忽略警告。<br>接着在删除用户时指定 <code>-r</code> 参数，再次查看 luke8 用户的 home 目录，此时已经不存在了。<br><code>-r</code> 选项不仅会删除用户的 home 目录，同时也将用户的 mail 文件一并删除掉。</p><h3 id="用户相关的系统文件">用户相关的系统文件</h3><h4 id="etc-default-useradd">/etc/default/useradd</h4><p>在<a href="#用户管理">创建用户</a>那一节中，我们直接使用命令 <code>useradd luke1</code> 创建一个名为 luke1 的新 user，虽然我们没有指定 <code>-m</code> 和 <code>-U</code> 参数，系统仍然为我们创建了 <code>/home/luke1</code> 目录作为该用户的 home 目录，并且同时创建了一个同名的组作为该用户的主组。这是因为系统为我们提供了一组默认的行为，当我们创建新用户时，如果忽略了某些选项，则系统会使用这些默认行为来协助我们创建用户。这些默认值保存在 <code>/etc/default/useradd</code> 中。让我们通过 <code>cat</code> 命令来查看该文件中的内容：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat /etc/default/useradd
</span><span style="color:#75715e"># useradd defaults file
</span><span style="color:#75715e"></span>GROUP<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>             <span style="color:#75715e"># 如果创建用户时指定了 -N，并且没有指定 -g，则默认使用组 ID 为 100 的组作为新用户的主组
</span><span style="color:#75715e"></span>HOME<span style="color:#f92672">=</span>/home            <span style="color:#75715e"># 默认在 /home 目录下创建用户 home 目录
</span><span style="color:#75715e"></span>INACTIVE<span style="color:#f92672">=</span>-1           <span style="color:#75715e"># 默认账户不过期
</span><span style="color:#75715e"></span>EXPIRE<span style="color:#f92672">=</span>               <span style="color:#75715e"># 默认不设置密码过期天数
</span><span style="color:#75715e"></span>SHELL<span style="color:#f92672">=</span>/bin/bash       <span style="color:#75715e"># /bin/bash 作为用户的默认 SHELL
</span><span style="color:#75715e"></span>SKEL<span style="color:#f92672">=</span>/etc/skel        <span style="color:#75715e"># 默认将 /etc/skel 下的所有文件拷贝到新用户的 home 目录下
</span><span style="color:#75715e"></span>CREATE_MAIL_SPOOL<span style="color:#f92672">=</span>yes # 默认创建用户的 mail spool</code></pre></div><h4 id="etc-passwd">/etc/passwd</h4><p>当一个用户尝试登录系统时，系统首先会查看 <code>/etc/passwd</code> 文件，该文件保存了当前系统中所有用户的信息。每当我们新创建一个新用户时，也会在该文件中追加一条记录。同样，当修改或删除某个用户时，也会更新该文件。因此，我们可以将文件 <code>/etc/passwd</code> 看做是系统中用户保存用户信息的数据库文件。</p><p><code>/etc/passwd</code> 是一个文本文件，系统中的任何一个用户都可以查看它的内容，但只有 root 用户可以修改它的内容。可以通过 <code>cat</code> 命令直接查看该文件内容：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat /etc/passwd
</span><span style="color:#75715e"></span>...
luke7:x:1011:1011:Testing user:/home/luke7:/bin/bash
...</code></pre></div><p><br></p><p>也可以借助 <code>getent</code> 命令的子命令 <code>passwd</code> 来获取全部或指定的某条用户记录信息，如：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># getent passwd luke7
</span><span style="color:#75715e"></span>luke7:x:1011:1011:Testing user:/home/luke7:/bin/bash</code></pre></div><blockquote><p>如果不指定 luke7，则打印出全部用户信息。<br><br></p></blockquote><p>每条用户记录在文件中占用一行，并且由多个字段组成，各个字段之间使用冒号（:）分隔，其格式为：</p><p><img src="/img/devops/linux-etc-passwd-fa9a294672.png" alt="etc-passwd"><br><br></p><ol><li>用户名：用户的登录名。<br></li><li>Password：密码占位符 X，它并不是用户真正的密码。该字段是历史遗留下来的，真正的密码被保存在 <code>/etc/shadow</code> 文件中。<br></li><li>用户 ID(UID)：每个用户在系统中都有一个唯一的标识 ID。其中 root ID 为0，1~99 为系统保留 ID。自定义用户起始 ID 为 1000，每创建一个新用户，其 UID 在上一个 UID 基础上依次累加 1。<br></li><li>组 ID(GID)：用户所属的主组。<br></li><li>用户注释：创建用户时通过 <code>-c</code> 选项为用户指定的注释信息。<br></li><li>Home 目录：用户的 home 目录。当使用一个 home 目录没有被创建的用户登录系统是，目录会被自动切换到系统根目录 <code>/</code> 下。<br></li><li>当用户登录系统是自动执行的命令：它通常指向一个 shell。可以通过将该项指定为 <code>/bin/false</code> 来禁止用户进行登录操作。<br><br></li></ol><p>当我们尝试修改该 <code>/etc/passwd</code> 内容时，最好是使用命令 <code>vipw</code> 来修改，而不是使用一般的编辑器工具。该命令可以在我们修改该文件时自动加入文件锁，防止多用户同时修改造成冲突。<br><br></p><p>另外，如果我们手动修改了这些文件，一定要保证修改后的文件和用户信息的正确性，任何一点小错误都可能导致用户无法正确登录到系统中。检查是否有错误最简单的办法是使用 <code>pwck</code> 命令。直接在命令行中输入 <code>pwck</code> 命令，可以打印出任何需要修复的问题。</p><h4 id="etc-shadow">/etc/shadow</h4><p><code>/etc/shadow</code> 是另一个比较重要的文件，它存储了所有用户的密码信息和密码过期时间等信息。</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat /etc/shadow
</span><span style="color:#75715e"></span>...
luke1:$1$L936UA7E$03ZIw90xe.0f4cZO.MBiJ.:17586:0:99999:7:::
...</code></pre></div><p>该文件只有 root 用户有查看权限，与 <code>/etc/passwd</code> 类似，文件中的每一行都是一条单独的记录，每条记录中又包含了多个字段。下面对各个字段进行了简单的描述：</p><ol><li>用户的登录名。<br></li><li>密码字段。该字段可能有以下几种值：<br><ul><li>空值，表明当前用户登录密码为空；<br></li><li>星号代表帐号被锁定；<br></li><li>双叹号表示这个密码已经过期了；<br></li><li><code>$1$</code> 表明是用MD5加密；<br></li><li><code>$2$</code> 是用Blowfish加密；<br></li><li><code>$5$</code> 是用 SHA-256加密；<br></li><li><code>$6$</code> 开头的，表明是用SHA-512加密；<br></li></ul></li><li>密码最后修改时间，其值为距 1970.1.1 号到密码修改那天的天数。<br></li><li>两次密码修改的最小天数间隔。0表示没有限制。<br></li><li>密码最多可以使用的天数，即多少天后密码过期。<br></li><li>密码过期前多少天开始提示警告信息。<br></li><li>密码过期多少天后账号将被禁用<br></li><li>距离 1970.1.1 号多少天后账号将被禁用<br></li><li>最后一个字段为保留字段，没有被使用。<br><br></li></ol><hr><h2 id="组管理">组管理</h2><p>在 Linux 系统中，有两种类型的组：主组 和 其他组。每个用户都必须有且只能有一个主组，并且至少属于一个其他组。当新创建一个用户时，如果没有通过 <code>-g</code> 参数为这个用户指定一个主组，系统则会自动创建一个与用户名同名的组，并将新创建的组设置为该用户的主组。<br><br></p><p>主组与其他组最重要的却别在于，当用户创建一个新文件时，文件所属的组为用户的主组，并且，没有任何主组的用户，将无法登录到系统中；而对用用户的其他组来说，当用户操作一个不属于自己的文件，且文件所属组不是当前用户的主组时，但该用户属于该文件所属组下的成员，即该用户的其他组中包含文件所属的组，则该用户可以以组的权限来操作该文件。</p><h3 id="groupadd-创建组"><code>groupadd</code> 创建组</h3><p>虽然创建用户时，系统可以帮助我们同时创建对应的组，但总有些时候，我们需要手动创建一些组。<br>Linux 系统命令 <code>groupadd</code> 就是用来创建新组的，他的基本格式为：<code>groupadd [options] group</code>。<br><br></p><p>下面列出了一些常用的选项：</p><ul><li><code>-g, --gid GID</code>： 将值 GID 做为新创建组的组 ID。<br></li><li><code>-f, --force</code>：当重复创建一个系统中已经存在的组时，<code>groupadd</code> 命令将直接退出，并且将命令的执行结果设置为失败。<code>-f</code> 选项将通知系统，即使创建一个已经存在的组时，命令也将返回成功。<br><br></li></ul><h4 id="示例-6">示例</h4><p><strong>创建组时指定组 ID</strong><br>每个组都有一个系统唯一的标识符 组 ID（GID），当创建组时，系统将默认分给一个 ID 做为新创建组的组 ID。我们可以通过使用 <code>-g</code> 参数，为新创建的组指定一个自定义的组 ID。<br>下面示例展示了如何创建一个组 ID 为 11000 的新组 grouptesting：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span># groupadd -g <span style="color:#ae81ff">1100</span> grouptesting</code></pre></div><p><br></p><p><strong>强制创建新组</strong><br>在上面的命令中，我们创建了一个名为 grouptesting 的新组，如果再次尝试创建一个同名的组，则将提示错误，同时命令返回失败：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># groupadd grouptesting
</span><span style="color:#75715e"></span>groupadd: group <span style="color:#e6db74">&#39;grouptesting&#39;</span> already exists
<span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># echo $?
</span><span style="color:#75715e"></span><span style="color:#ae81ff">9</span></code></pre></div><p>可以看到，<code>groupadd</code> 命令的返回值为 9，表示该组已经存在，命令执行失败。<br><br></p><p>使用 <code>-f</code> 参数：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># groupadd -f grouptesting
</span><span style="color:#75715e"></span><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># echo $?
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0</span></code></pre></div><p>当我们指定了 <code>-f</code> 参数后，<code>groupadd</code> 命令的返回值为0，表示执行成功。<br><br></p><h3 id="查看组信息">查看组信息</h3><p><code>groups</code> 命令可以用来获取指定用户的组信息，如果没有指定登录用户，则获取当前用户组信息，如：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># groups
</span><span style="color:#75715e"></span>root
<span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e">#
</span><span style="color:#75715e"></span><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># getent group luke1
</span><span style="color:#75715e"></span>luke1:x:1002:luke1</code></pre></div><p><br></p><p>可以使用 <code>getent group</code> 命令获取某个组的信息，如：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># getent group luke1
</span><span style="color:#75715e"></span>luke1:x:1002:luke1</code></pre></div><p>如果没有指定组名，则获取当前系统中的所有组信息。</p><h3 id="groupmod-修改组信息"><code>groupmod</code> 修改组信息</h3><p><code>groupmod</code> 命令可以用来修改一个已经存在的组，其格式为： <code>groupmod [options] GROUP</code>。<br><br></p><p>下面列出了一些常用的选项：</p><ul><li><code>-g, --gid GID</code>：修改组 ID，<br></li><li><code>-n, --new-name NEW_GROUP</code>：更新组名<br><br></li></ul><h4 id="示例-7">示例</h4><p>更新 grouptesting 组名为 grouptest，同时修改它的组 ID：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span># groupmod -n <span style="color:#ae81ff">1200</span> -g grouptest</code></pre></div><h3 id="groupdel-删除组"><code>groupdel</code> 删除组</h3><p>当某个组不在使用时，我们应当使用系统命令 <code>groupdel</code> 删除这个组，并将要删除的组名作为参数传递给该命令。</p><blockquote><p>注意：我们无法删除某个仍然作为其他用户主组的组。<br><br></p></blockquote><p>下面例子展示了如何删除我们刚刚创建的新组 grouptesting：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span># groupdel grouptesting</code></pre></div><p><br></p><blockquote><p>注意：当删除某个组之后，任何所属组为被删除组的文件的组信息都将失效，同时显示为被删除组的组 ID。</p></blockquote><h3 id="组相关的系统文件">组相关的系统文件</h3><h4 id="etc-group">/etc/group</h4><p>系统中所有组的信息全部保存在 <code>/etc/group</code> 文件中，与用户信息一样，每条组记录在文件中占用单独一行，记录一共有3个字段，分别为 组名、组密码占位符 <code>X</code> 组 ID 以及。可以使用 <code>cat</code> 命令直接查该文件内容：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span># cat /etc/group</code></pre></div><p><br></p><p>也可以借助 <code>getent</code> 命令的子命令 <code>group</code> 来获取全部或指定的某条组记录信息，如：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># getent group root
</span><span style="color:#75715e"></span>root:x:0:</code></pre></div><div class="footnotes"><hr><ol><li id="fn:1">很多系统还提供了更加高级的 <code>adduser</code> 命令，而在 CentOS 7 中，<code>adduser</code> 则是以 <code>useradd</code> 命令的软连接的形式存在的。<br><a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li></ol></div></article></div><div class="card-action card-action-links"><a class="btn btn-secondary" href="https://gbyukg.github.io/tags/centos">CentOS</a> <a class="btn btn-secondary" href="https://gbyukg.github.io/tags/linux">Linux</a></div><div class="card-action"><div id="comment"></div><style>.v .vwrap .vheader .vinput:focus {
    border-bottom-color: #607d8b;
  }</style><script>window.VALINECONFIG = {
    el: '#comment',
    notify: false,
    verify: false,
    appId: 'EpIUIjYDVRQ3Fw4Qu9vGWbpb-gzGzoHsz',
    appKey: 'Yq4U0b4Ob2ujjlltku64dyuj',
    placeholder: '写点什么吧...',
    path: window.location.pathname,
    avatar: 'retro'
  }</script></div><div class="pagination-single"><span class="pagination-item next"><a href="https://gbyukg.github.io/posts/compile-php-apache/" rel="next">CentOS7 下编译安装 Apache2.4 &#43; PHP5.6</a> <i class="material-icons">navigate_next</i></span></div></div></div></section></div></div></div><footer class="page-footer"><div class="container"><div class="inner"><div class="wrapper"><div class="group group-slink"><h5>World of Forks</h5><p>Theme <a href="https://github.com/stkevintan/canoe" target="_blank">canoe</a> designed by <a href="https://github.com/stkevintan" target="_blank">Kevin Tan</a> with ❤</p><ul class="slink"><li><a href="https://www.facebook.com/gbyukg" target="_blank" title="Facebook"><svg class="svg-icons svg-icons-facebook"><use xlink:href="#svg-icons-facebook"></use></svg></a></li><li><a href="https://github.com/gbyukg" target="_blank" title="Github"><svg class="svg-icons svg-icons-github"><use xlink:href="#svg-icons-github"></use></svg></a></li><li><a href="https://twitter.com/zloggg" target="_blank" title="Twitter"><svg class="svg-icons svg-icons-twitter"><use xlink:href="#svg-icons-twitter"></use></svg></a></li></ul></div><div class="group group-flink"><h5>My Friends</h5><ul><li><a href="http://www.cnblogs.com/gbyukg" target="_blank">gbyukg</a></li></ul></div></div></div></div><div class="footer-copyright"><div class="container"><div class="inner">Copyleft@Kevin Tan</div></div></div></footer></main><script type="text/javascript" async src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type="text/javascript" src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script><script src="https://cdn.bootcss.com/highlight.js/9.12.0/languages/go.min.js"></script><script src="https://cdn.bootcss.com/highlight.js/9.12.0/languages/typescript.min.js"></script><script>hljs.configure({
    tabReplace: '  '
  })
  hljs.registerLanguage("graphql", function (e) { return { aliases: ["gql"], k: { keyword: "query mutation subscription|10 type interface union scalar fragment|10 enum on ...", literal: "true false null" }, c: [e.HCM, e.QSM, e.NM, { cN: "type", b: "[^\\w][A-Z][a-z]", e: "\\W", eE: !0 }, { cN: "literal", b: "[^\\w][A-Z][A-Z]", e: "\\W", eE: !0 }, { cN: "variable", b: "\\$", e: "\\W", eE: !0 }, { cN: "keyword", b: "[.]{2}", e: "\\." }, { cN: "meta", b: "@", e: "\\W", eE: !0 }], i: /([;<']|BEGIN)/ } });
  hljs.initHighlightingOnLoad();</script><script type="text/javascript" src="https://gbyukg.github.io/js/polyfill-dae721e58b.js"></script><script type="text/javascript" src="https://gbyukg.github.io/js/index-168a331ded.js"></script></body></html>